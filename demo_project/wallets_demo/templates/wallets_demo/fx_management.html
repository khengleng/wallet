{% extends 'wallets_demo/base.html' %}

{% block title %}FX Management - DJ Wallet{% endblock %}

{% block content %}
<div class="card">
    <h2>FX Rate Management</h2>
    <p class="text-muted">Manage active FX rates used by wallet conversion and accounting revaluation.</p>
    <a class="btn btn-outline mt-4" href="{% url 'accounting_dashboard' %}">Back to Accounting</a>
</div>

<div class="card">
    <h3>Sync International FX Source</h3>
    <p class="text-muted">Pull latest rates from provider: <strong>{{ fx_provider }}</strong>.</p>
    <form method="post">
        {% csrf_token %}
        <input type="hidden" name="action" value="sync_external">
        <div class="form-group">
            <label for="sync_base_currency">Base Currency</label>
            <select id="sync_base_currency" name="sync_base_currency" required>
                {% for c in supported_currencies %}
                <option value="{{ c }}" {% if c == base_currency %}selected{% endif %}>{{ c }}</option>
                {% endfor %}
            </select>
        </div>
        <button class="btn btn-primary" type="submit">Sync Latest Rates</button>
    </form>
</div>

<div class="card">
    <h3>Create FX Rate</h3>
    <form method="post">
        {% csrf_token %}
        <input type="hidden" name="action" value="manual">
        <div class="form-group">
            <label for="base_currency">Base Currency</label>
            <select id="base_currency" name="base_currency" required>
                {% for c in supported_currencies %}
                <option value="{{ c }}">{{ c }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="quote_currency">Quote Currency</label>
            <select id="quote_currency" name="quote_currency" required>
                {% for c in supported_currencies %}
                <option value="{{ c }}">{{ c }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="rate">Rate</label>
            <input id="rate" name="rate" type="number" step="0.00000001" min="0.00000001" required>
        </div>
        <button class="btn btn-primary" type="submit">Save Rate</button>
    </form>
</div>

<div class="card">
    <h3>Active FX Rates</h3>
    <table>
        <thead>
            <tr>
                <th>Pair</th>
                <th>Rate</th>
                <th>Provider</th>
                <th>Effective At</th>
                <th>Created By</th>
            </tr>
        </thead>
        <tbody>
            {% for fx in fx_rates %}
                <tr>
                    <td>{{ fx.base_currency }}/{{ fx.quote_currency }}</td>
                    <td>{{ fx.rate }}</td>
                    <td>{% if fx.source_provider %}{{ fx.source_provider }}{% else %}-{% endif %}</td>
                    <td>{{ fx.effective_at|date:"Y-m-d H:i" }}</td>
                    <td>{% if fx.created_by %}{{ fx.created_by.username }}{% else %}-{% endif %}</td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="5" class="text-muted" style="text-align:center;">No FX rates yet.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
